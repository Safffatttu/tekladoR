<!DOCTYPE html>
<html>

<head>
	<script>
		function uploadSettings() {
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "/setsettings", true);
			xhr.setRequestHeader('Content-Type', 'application/json');

			let settings = {};

			settings.deviceTopic = document.getElementById("deviceTopicInput").value;
			settings.wifi_ssid = document.getElementById("wifi_ssidInput").value;
			settings.wifi_password = document.getElementById("wifi_passwordInput").value;
			settings.mqtt_host = document.getElementById("mqtt_hostInput").value;
			settings.mqtt_port = document.getElementById("mqtt_portInput").value;

			let settingText = JSON.stringify(settings);
			xhr.send(settingText);
		};

		function uploadIoConfig() {
			var xhr = new XMLHttpRequest();
			xhr.open("POST", "/setioconfig", true);
			xhr.setRequestHeader('Content-Type', 'application/json');
			let configText = document.getElementById("ioText").value;

			try {
				JSON.parse(configText);
			} catch (error) {
				alert("Could not parse io config");
				return;
			}

			xhr.send(configText);
		};

		function loadConfiguration() {
			var ioConfigReq = new XMLHttpRequest();
			ioConfigReq.open("GET", "/getioconfig", true);
			ioConfigReq.onreadystatechange = function () {
				if (ioConfigReq.readyState == 4 && ioConfigReq.status == 200) {
					document.getElementById("ioText").value = ioConfigReq.responseText
				}
			};
			ioConfigReq.send(null);

			var settingsConfigReq = new XMLHttpRequest();
			settingsConfigReq.open("GET", "/getsettings", true);
			settingsConfigReq.onreadystatechange = function () {
				if (settingsConfigReq.readyState == 4 && settingsConfigReq.status == 200) {
					let data = JSON.parse(settingsConfigReq.responseText);

					document.getElementById("deviceTopicInput").value = data.deviceTopic;
					document.getElementById("wifi_ssidInput").value = data.wifi_ssid;
					document.getElementById("wifi_passwordInput").value = data.wifi_password;
					document.getElementById("mqtt_hostInput").value = data.mqtt_host;
					document.getElementById("mqtt_portInput").value = data.mqtt_port;
				}
			};
			settingsConfigReq.send(null);

			var serialNumReq = new XMLHttpRequest();
			serialNumReq.open("GET", "/getserialnum", true);
			serialNumReq.onreadystatechange = function () {
				if (serialNumReq.readyState == 4 && serialNumReq.status == 200) {
					document.getElementById("serialNum").textContent = serialNumReq.responseText;
				}
			};
			serialNumReq.send(null);
		};

	</script>
</head>

<body onload="loadConfiguration()">
	<h1>TekladoR IO Module configurator</h1>
	Serial number: <span id="serialNum"></span>
	<br>

	<p>
		<label for="settingsText">Settings</label>

	<table>
		<tr>
			<td>deviceTopic</td>
			<td>
				<input type="text" id="deviceTopicInput">
			</td>
		</tr>
		<tr>
			<td>wifi_ssid</td>
			<td>
				<input type="text" id="wifi_ssidInput">
			</td>
		</tr>
		<tr>
			<td>wifi_password</td>
			<td>
				<input type="text" id="wifi_passwordInput">
			</td>
		</tr>
		<tr>
			<td>mqtt_host</td>
			<td>
				<input type="text" id="mqtt_hostInput">
			</td>
		</tr>
		<tr>
			<td>mqtt_port</td>
			<td>
				<input type="text" id="mqtt_portInput">
			</td>
		</tr>
	</table>

	<button onclick="uploadSettings()">Upload settings</button>
	</p>
	<p>
		<label for="ioText">Io configuration</label>
		<br>
		<textarea id="ioText" name="IO configuration" rows="30" cols="40"></textarea>
		<br>
		<button onclick="uploadIoConfig()">Upload configuration</button>
	</p>
	<br>
	<br>
	<br>

	<a href="https://github.com/Safffatttu/tekladoR">Documentation and source code</a>

</body>

</html>